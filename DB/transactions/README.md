# Что такое транзакция?

**Транзакция** — это набор операций, которые выполняются как единое целое. В контексте баз данных транзакция гарантирует, что операции в рамках этой группы будут выполнены полностью и корректно, либо вообще не будут выполнены, если произошла ошибка. Это важный механизм для обеспечения целостности и согласованности данных.

### Основные характеристики транзакции:
1. ACID-свойства: Транзакции должны следовать принципам, известным как ACID. Это аббревиатура, которая описывает четыре ключевых свойства:
- Atomicity (Атомарность): Это свойство гарантирует, что транзакция рассматривается как единая, неделимая единица работы. Это означает, что либо все операции в транзакции завершаются успешно, либо ни одна из них не применяется к базе данных. В случае неудачи база данных откатывается к состоянию до транзакции, таким образом поддерживается согласованность.
- Consistency (Согласованность): Это свойство гарантирует, что база данных остается в неизменном состоянии на протяжении всей транзакции. СУБД проверяет ограничения целостности до и после транзакции и откатывает транзакцию, если какое-либо ограничение нарушено.
- Isolation (Изолированность): Это свойство гарантирует, что изменения, внесенные транзакцией, не видны другим транзакциям до тех пор, пока транзакция не будет зафиксирована. Такая изоляция помогает предотвратить конфликты между параллельными транзакциями.
- Durability (Долговечность): ПЭто свойство гарантирует, что изменения, внесенные транзакцией, являются постоянными и сохраняются после любых последующих сбоев. СУБД использует технику, называемую протоколированием, чтобы гарантировать, что изменения, внесенные транзакцией, могут быть отменены в случае сбоя.

### Зачем нужны транзакции в базе данных?
Существует несколько причин, по которым транзакции в базе данных необходимы:

- **Согласованность данных:** Транзакции базы данных помогают поддерживать согласованность и целостность данных, гарантируя, что база данных остается в неизменном состоянии даже в случае системных сбоев или ошибок.
- **Одновременный доступ:** Транзакции позволяют нескольким пользователям одновременно получать доступ к базе данных и обновлять ее без конфликтов. Это гарантирует, что изменения, внесенные одной транзакцией, изолированы от изменений, внесенных другими транзакциями.
- **Атомарность:** Транзакции обеспечивают свойство атомарности, означающее, что все операции транзакции выполняются как единая, неделимая единица работы. Это означает, что если какая-либо операция в транзакции завершится неудачно, вся транзакция будет откачена, оставив базу данных в исходном состоянии.
- **Восстановление:** Транзакции обеспечивают возможность восстановления после сбоев или ошибок, возникающих во время выполнения транзакции. Если в системе произошел сбой, СУБД может использовать информацию журнала для отмены всех изменений, которые были сделаны в рамках транзакции, возвращая базу данных в согласованное состояние.
- **ACID Свойства:** Свойства ACID (Atomicity, Consistency, Isolation, Durability), которые обеспечивают транзакции, необходимы для поддержания согласованности и целостности базы данных. Свойство изоляции гарантирует, что изменения, внесенные транзакцией, не видны другим транзакциям до тех пор, пока транзакция не будет зафиксирована, а долговечность гарантирует, что изменения, внесенные транзакцией, сохранятся после любых последующих сбоев.

2. Типы транзакций:
- Commit: После выполнения всех операций транзакция подтверждается командой COMMIT. Это означает, что изменения, внесенные в рамках транзакции, становятся постоянными.
- Rollback: Если в процессе выполнения транзакции произошла ошибка, можно откатить все изменения с помощью команды ROLLBACK. Это возвращает базу данных в состояние до начала транзакции.
- Пример транзакции в SQL: Рассмотрим пример транзакции, которая выполняет две операции: перевод денег с одного счета на другой. Если одна из операций не удалась (например, недостаточно средств на одном из счетов), вся транзакция должна быть откатана.

```sql
BEGIN TRANSACTION;

UPDATE accounts SET balance = balance - 100 WHERE account_id = 1;
UPDATE accounts SET balance = balance + 100 WHERE account_id = 2;

-- Если все прошло успешно
COMMIT;

-- Если произошла ошибка
-- ROLLBACK;
```
### Применение в реальном мире: Транзакции используются во многих сферах, например:

- Базы данных: Например, при изменении данных в нескольких таблицах необходимо, чтобы все изменения происходили как единое целое.
- Финансовые операции: При переводе средств между счетами важно, чтобы деньги были списаны с одного счета и зачислены на другой. Если операция не может быть завершена, важно откатить все изменения, чтобы избежать потерь.

### Преимущества транзакций:
- Целостность данных: Транзакции помогают гарантировать, что данные будут всегда в консистентном и правильном состоянии.
- Обработка ошибок: В случае ошибки можно откатить все изменения, сделанные в рамках транзакции.
- Параллельность: Транзакции позволяют параллельно выполнять несколько операций без нарушения целостности данных.

### Заключение:
**Транзакция** — это важный механизм для обеспечения надежности и целостности данных в приложениях, работающих с базами данных. Она гарантирует, что операции либо будут выполнены полностью, либо откатятся, если возникнут проблемы.
