**Сборщик мусора (Gagbage Collector)** в Go работает по классическому алгоритму Mark and Sweep с некоторыми усовершенствованиями для минимизации пауз и повышения производительности. Основные этапы работы:

1. Mark (маркировка): GC находит все достижимые (живые) объекты, начиная с корневых — глобальных переменных, стека и других источников, и помечает их как живые. При этом объекты, доступные из помеченных, тоже помечаются, пока весь граф достижимых объектов не будет пройден. Для корректной работы на этом этапе приложение приостанавливается (пусть и недолго) — это называется пауза Stop The World (STW).

2. Sweep (очистка): GC проходит по памяти и освобождает объекты, которые не были помечены как живые (недостижимые объекты). Эта фаза происходит параллельно с работой приложения и менее затратна по ресурсам.

3. В Go память сначала помечается доступной для перезаписи, а затем специальный процесс "Scavenger" постепенно возвращает её обратно операционной системе.

Go GC реализован с минимизацией времени пауз и работает конкурентно с приложением за счет специальных механизмов, таких как Write Barrier и работы "помощников" — горутин, которые участвуют в процессе разметки. Память не компактизируется (объекты не перемещаются), управляя фрагментацией другими способами.

Также в Go можно управлять агрессивностью сборщика мусора через параметр GOGC, который задает порог по отношению нового мусора к живой памяти, при котором запускается сборка.

Таким образом, сборщик мусора в Go — это конкурентный Mark-and-Sweep с минимальными паузами для маркировки и параллельной очисткой памяти, что обеспечивает баланс между производительностью и эффективным управлением памятью.


**Маркировка (Mark)** в сборщике мусора Go — это процесс выявления всех живых (достижимых) объектов в памяти. Он реализуется через так называемый трехцветный алгоритм маркировки, который делит объекты на три множества:

- Белые — потенциальный мусор, объекты, еще не проверенные.

- Серые — объекты, помеченные как живые, но дочерние объекты которых еще не проверены.

- Черные — объекты, помеченные как живые, и у которых все дочерние объекты уже проверены.

Алгоритм начинает с корневых объектов (глобальные переменные, стеки горутин), окрашивает их в серый цвет и помещает в очередь. Далее итеративно берет из очереди серый объект, красит его в черный и рассматривает все объекты, на которые он ссылается. Если встречает белый объект, то окрашивает его в серый и добавляет в очередь.

Этот процесс продолжается, пока в очереди серых объектов не останется. По окончании все объекты, оставшиеся белыми, считаются недостижимыми и подлежат освобождению.

Для корректности алгоритм маркировки требует остановки программы на короткие паузы (Stop-The-World) на начале и в конце этапа маркировки, однако большая часть работы выполняется параллельно с приложением. Для предотвращения ошибок во время одновременной работы GC и каркающего кода используется механизм Write Barrier, который отслеживает изменения ссылок во время маркировки.

Таким образом, маркировка — это обход графа объектов в памяти, начиная с корней, для обнаружения всех используемых приложением объектов и отделения мусора для последующего удаления.